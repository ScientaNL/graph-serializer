"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Scheme=function(){this.serializer=function(e){return e},this.deserializer=function(e){return e}};exports.Scheme=Scheme;var PropertyDescription=function(){function e(e,r){void 0===r&&(r={}),this.direction=["serialize","deserialize"],this.name=e,this.setDecoration(r)}return e.prototype.setDecoration=function(e){return this.scheme=e.scheme||new Scheme,this.serializedName=e.serializedName||this.name,this.direction=e.direction||this.direction,this},e}();exports.PropertyDescription=PropertyDescription;var ClassDescription=function(){function e(e){var r=this;this.classConstructor=e,this.deserializationFactory=function(e){return new r.classConstructor},this.properties=new Map}return e.prototype.setDecoration=function(e){return void 0===e||(this.postDeserialize=e.postDeserialize||void 0),this},e}();exports.ClassDescription=ClassDescription;var Store=function(){function e(){this.map=new Map}return e.prototype.get=function(e){return this.map.has(e)||this.map.set(e,new ClassDescription(e)),this.map.get(e)},e.prototype.set=function(e,r){this.map.set(e,r)},e}(),store=new(exports.Store=Store);function deserialize(e,r){if(null===r)return null;var t=createClassDescription(e),i=t.deserializationFactory(r);return t.properties.forEach(function(e){void 0!==r[e.serializedName]&&-1!==e.direction.indexOf("deserialize")&&(i[e.name]=e.scheme.deserializer(r[e.serializedName]))}),"function"==typeof t.postDeserialize&&t.postDeserialize(i),i}function serialize(r){if(null===r)return null;if(Object.getPrototypeOf(r)===Object.prototype)return r;var t={};return createClassDescription(Object.getPrototypeOf(r).constructor).properties.forEach(function(e){-1!==e.direction.indexOf("serialize")&&(t[e.serializedName]=e.scheme.serializer(r[e.name]))}),t}function createClassDescription(e){var r=e,t=new ClassDescription(e);do{var i=store.get(r);r===e&&(t.deserializationFactory=i.deserializationFactory),t.postDeserialize=t.postDeserialize||i.postDeserialize,i.properties.forEach(function(e){t.properties.has(e.serializedName)||t.properties.set(e.serializedName,e)})}while((r=Object.getPrototypeOf(r))instanceof Function);return t}function array(r){void 0===r&&(r=exports.primitive);var e=new Scheme;return e.serializer=function(e){return e.map(function(e){return r.serializer(e)})},e.deserializer=function(e){return void 0===e?e:e.map(function(e){return r.deserializer(e)})},e}function objectMap(i){void 0===i&&(i=exports.primitive);var e=new Scheme;return e.serializer=function(e){if(void 0===e||"object"!=typeof e)return e;var r={};for(var t in e)!0===e.hasOwnProperty(t)&&(r[t]=i.serializer(e[t]));return r},e.deserializer=function(e){if(void 0===e||"object"!=typeof e)return e;var r={};for(var t in e)!0===e.hasOwnProperty(t)&&(r[t]=i.deserializer(e[t]));return r},e}function object(r){var e=new Scheme;return e.serializer=function(e){return serialize(e)},e.deserializer=function(e){return deserialize(r,e)},e}function custom(e,r){var t=new Scheme;return t.serializer=e,t.deserializer=r,t}function serializable(t){return void 0===t&&(t={}),function(e,r){if(1===arguments.length)store.get(e).setDecoration(t);else{if(3!==arguments.length)throw new Error("Invalid decorator");store.get(e.constructor).properties.set(r,new PropertyDescription(r,t))}}}function postDeserialize(){return function(e,r,t){if(3!==arguments.length)throw new Error("Invalid decorator");var i=store.get(e);i.postDeserialize=t.value,store.set(e,i)}}function deserializationFactory(){return function(e,r,t){if(3!==arguments.length)throw new Error("Invalid decorator");var i=store.get(e);i.deserializationFactory=t.value,store.set(e,i)}}exports.deserialize=deserialize,exports.serialize=serialize,exports.primitive=new Scheme,exports.date=function(){var e=new Scheme;return e.serializer=function(e){return e instanceof Date?e.toJSON():e},e.deserializer=function(e){return"string"==typeof e?new Date(e):e},e}(),exports.array=array,exports.objectMap=objectMap,exports.object=object,exports.custom=custom,exports.serializable=serializable,exports.postDeserialize=postDeserialize,exports.deserializationFactory=deserializationFactory;